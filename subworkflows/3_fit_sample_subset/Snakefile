""" Benchmarking the OptiFit algorithm using subsets of datasets """

subworkflow prep_samples:
    workdir:
        "../1_prep_samples/"


datasets = ["soil"] #, "human", "marine", "mouse"]
regions = ['bact_v4']
methods = ["open", "closed"]
printrefs = ['f']
seeds = range(1,2)
random_refweight_options = ['simple']#, 'abundance', 'distance']
ref_fracs = [i/10 for i in range(2,10,2)]

rule subset_targets:
    input:
        expand("data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/sample.accnos", dataset=datasets, ref_weight=random_refweight_options, sample_frac=[0.2], ref_frac=[0.2], seed=seeds)

rule copy_data:
    input:
        fasta=prep_samples("data/{dataset}/processed/{dataset}.fasta"),
        count=prep_samples("data/{dataset}/processed/{dataset}.count_table"),
        dist=prep_samples("results/{dataset}/{dataset}.dist")
    output:
        fasta="data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/{dataset}.fasta",
        count="data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/{dataset}.count_table",
        dist="data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/{dataset}.dist"
    shell:
        """
        cp {input.fasta} {output.fasta}
        cp {input.count} {output.count}
        cp {input.dist} {output.dist}
        """


rule split_weighted_subsample:
    input:
        code="../../code/py/split_weighted_subsample.py",
        fasta=rules.copy_data.output.fasta,
        count=rules.copy_data.output.count,
        dist=rules.copy_data.output.dist
    output:
        ref_accnos="data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/ref.accnos",
        sample_accnos="data/{dataset}/refweight_{ref_weight}/reffrac_{ref_frac}/samplefrac_{sample_frac}/seed_{seed}/sample.accnos"
    benchmark:
        "benchmarks/{dataset}/split_weighted_subsample.refweight_{ref_weight}.reffrac_{ref_frac}.samplefrac_{sample_frac}.seed_{seed}.txt"
    script:
        "../../code/py/split_weighted_subsample.py"





